---
title: "なぜ今、モジュラーモノリスという意思決定をしたのか ― 新しいBounded Contextとドメイン設計を起点にしたアーキテクチャ転換 ―"
emoji: "🏗️"
type: "tech"
topics:
  - "architecture"
  - "ddd"
  - "go"
  - "monolith"
published: false
publication_name: "pivotmedia"
---

## はじめに

### この記事で書きたいこと

この記事は、特定の技術やフレームワークの解説を目的としたものではありません。

また、あるアーキテクチャが常に正しいと主張するものでもありません。

PIVOTで新機能（コメント機能）を開発するにあたり、なぜこのタイミングで「モジュラーモノリス」という判断をしたのか、その背景にあった問題意識と意思決定の流れを、技術的な結果ではなく**判断そのもの**に焦点を当てて記録することを目的としています。

### 前提となる状況

当時のPIVOTのバックエンドは、PHPで実装された既存システムを段階的にGoへ移行している途中段階でした。

新機能としてコメント機能の開発が決まり、同時にAI時代におけるエンジニアリングの役割について考える機会が増えていた時期でもありました。


## Go移行によって「次に進める状態」にはなっていた

### Go移行で整えたこと

PHPからGoへの移行でまず重視していたのは、設計の理想形を作ることではありませんでした。

**これ以上レガシーを増やさないこと**が最優先でした。

- ステートレスでコンテナ化可能なアプリケーションにすること[^5]
- サーバー状態に依存する実装を排除すること
- 運用・保守を前提とした最低限の技術的健全性を確保すること

これらが、このフェーズの主眼でした。スタートアップでは避けて通れない重要な段階だったと思います。

[^5]: 当時の課題例として、ローカルファイルシステムへのキャッシュファイル保存、VM上で動作するCronジョブ、サーバー固有の設定ファイルへの依存など、コンテナ化と相性の悪いコードベースになっていました。

### Goに持ってきたが、すべてが解決したわけではなかった

既存の実装をそのままGoに移した部分も多く、触りづらさや見通しの悪さは依然として残っていました。

「次にどこを直すべきか」という課題感はありました。

ただし、この時点では機能開発も並行して進んでおり、PHPからの移行も完全には終わっていませんでした。

そのため、抜本的な設計変更に踏み切る必然性はまだ強くありませんでした。


## 課題の「重要度」が変わっていった

### 課題自体は以前から見えていた

以前から認識していた課題がありました。

- 実装がユースケース単位の手続き的な構造になっていること
- ドメインがコード上で明示的に表現されていないこと
- 変更時に影響範囲を読みづらいこと

ただし当時は、数ある改善課題の一つに過ぎませんでした。

「いずれ向き合うもの」という位置づけに留まっていました。

### 川島さんとの対話で変わった認識

技術アドバイザーとして入っていただいている川島さんとの継続的な対話の中で、この課題に対する捉え方が大きく変わっていきました。

**本質的複雑さと偶有的複雑さの区別**[^2]、**ニューレガシーアンチパターンという言語化**[^3]、画面駆動・テーブル駆動設計への自覚を通じて、問題が単なる実装技術の話ではなく、**構造の話**であることがはっきりしてきました。

特に印象的だったのは、AI時代において人間がやるべき仕事は、**依存の中心となるドメインを定義することだけ**であり、それ以外は原理的にAIが代替・支援できるという視点でした。

[^2]: 川島さん「古典ドメインモデリングパターンの解脱」では、ドメインモデリングの本質として「複雑さへの対処」が挙げられ、本質的複雑さを明らかにすることの重要性が述べられています。[古典ドメインモデリングパターンの解脱](https://scrapbox.io/kawasima/古典ドメインモデリングパターンの解脱_-_大吉祥寺.pm)

[^3]: ニューレガシーアンチパターンとは、レガシーシステム再構築時に新たなレガシーを生み出してしまう設計手法を指します。画面駆動・テーブル駆動設計、配線プログラミング、形式的なレイヤリングなどが典型例として挙げられています。[ニューレガシーアンチパターン](https://scrapbox.io/kawasima/ニューレガシーアンチパターン)

### 「後でやる」では済まされない課題になった

実装や配線、定型的なコード生成はAIによっていくらでも加速できます。

一方で、**どこに境界を引き、どの概念を同じ言語として扱うか**という判断は人間にしかできません。

この認識を持ったことで、ドメイン設計の位置づけが変わりました。

改善項目ではなく、**今後の開発効率と持続性を左右する中核的な課題**として捉えるようになったのです。

この判断を裏付けるために、以下の書籍も参照しながら考えを整理していました。[^4]

[^4]: 主に参考にした書籍: 『[ドメイン駆動設計をはじめよう](https://www.oreilly.co.jp/books/9784873119823/)』『[ソフトウェアアーキテクチャの基礎](https://www.oreilly.co.jp/books/9784814400737/)』『[実践ドメイン駆動設計](https://gihyo.jp/book/2017/978-4-7741-9087-7)』


## 新しいBounded Contextの機能開発という転機

### 既存システムの前提

既存のシステムは、**映像Viewerを中心としたコンテンツ配信**を前提としていました。

ユーザーは基本的に「**消費する側**」として完結していました。

インタラクションはほとんど想定されていない世界でした。

### コメント機能が持ち込んだ別の文脈

一方で、コメント機能は**ユーザー参加型**であり、既存機能とは明らかに異なる関心やルールを持つ世界です。

**全く違うBounded Context**というべきものでした。

この機能を既存の構造にそのまま組み込むと、ドメインの意味が混線し、将来的な変更耐性を著しく下げることが想像できました。

### このタイミングが「今」だった理由

同時に、これは**好機**でもありました。

- 新しいContextであるため既存コードを大きく壊さずに始められる
- 境界を自然に定義できる
- 今後の指針となるロールモデルを作れる

これらの条件が揃っていたため、このタイミングで**ドメイン設計に本気で取り組む条件が整った**と判断しました。


## マイクロサービスではなく「モジュラーモノリス」を選んだ理由

### 組織とチームの現実

この段階でマイクロサービス化を検討しなかったわけではありません。

しかし、チームと組織の現実を考えると**最適解ではありませんでした**。

当時のチーム構成では、**バックエンドの正社員エンジニアは実質的に一人**でした。

実行環境を分割するほどの複雑性や運用コストを許容できる状況ではありませんでした。

### 逆コンウェイの法則を前提にした判断

逆コンウェイの法則を考えると、**組織が分かれていないのに実装だけを分けるのは不自然**でした。

不用意な分割は、結果としてコストと複雑さを増やすだけだと判断しました。

### 境界は分けるが、実行単位は分けない

そこで選んだのが、**境界（Bounded Context）は明確に分けるが、実行・デプロイ単位は分けない**、というモジュラーモノリスのアプローチでした。

今のフェーズにおける現実解として、これが**最もバランスの取れた判断**だと考えています。


## 「ドメインを定義する」という意思決定

### Contextごとに意味を切り分ける

今回意識したのは、**Contextごとに意味を明確に切り分けること**でした。

同じオブジェクトであっても、Contextが違えば関心のある情報や振る舞いは異なります。

それらを無理に共通化するとモデルは肥大化していきます。

### Contextごとのドメイン言語

そのため、**Contextごとにドメイン言語を持つ**ことを重視しました。

その世界でのみ通じる言葉を許容し、境界を越えた意味の混線を防ぐことを重視しました。

### 新モジュールをロールモデルにする

コメント機能は、その最初の**ロールモデル**として位置づけています。

今後の新機能は、この方針で作っていくという合意をチームで持っています。


## 機能開発を遅らせてでも、今やる価値があった

### アーキテクチャに2週間使う判断

結果として、**機能開発に入る前に約2週間、アーキテクチャと構造の整理に時間を使うことにしました**。

短期的には機能開発が若干後ろ倒しになりますが、PMやチームと合意した上で、**全体としてはスピードは落ちない**という判断をしました。

### 実際に得られた結果

実際には、以下のような結果を得られました。

- **開発者体験が明らかに改善**
- **ドメインロジックが安定**
- **複雑な仕様調整を最後までやり切れた**

これらの結果につながりました。


## おわりに

### クリーンさがスピードを生む時代

スタートアップでは「クイック＆ダーティー」が語られがちですが、AI時代においては、**クリーンに定義されたドメインこそが結果的にスピードを生む**という逆転現象が起きているように感じています。

今回の判断は技術選定の話というよりも、**優先順位と意思決定の話**でした。

### 「今だった」という判断

課題は以前からありましたが、重要度の認識が変わり、新しいコンテキストという条件が揃ったため「**今**」やりました。

### 同じフェーズにいる人へ

書き換えても違和感が残っている場合、次に向き合うべきは実装技術ではなく、**設計そのもの**かもしれません。
